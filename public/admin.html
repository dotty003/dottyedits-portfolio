<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Dotty Edits</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #0a0a0a;
    }

    .modal-backdrop {
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
    }

    .tab-active {
      border-bottom: 2px solid white;
      color: white;
    }
  </style>
</head>

<body class="min-h-screen text-neutral-200 font-sans">
  <!-- Login Screen -->
  <div id="login-screen" class="min-h-screen flex items-center justify-center">
    <div class="bg-neutral-900 border border-neutral-800 p-8 rounded-lg w-full max-w-md">
      <h1 class="text-2xl font-bold text-white mb-6 text-center">Admin Login</h1>
      <form id="login-form" class="space-y-4">
        <div>
          <label class="block text-sm text-neutral-400 mb-2">Password</label>
          <input type="password" id="password-input"
            class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white transition-colors"
            placeholder="Enter admin password">
        </div>
        <button type="submit"
          class="w-full py-3 bg-white text-black font-bold rounded-lg hover:bg-neutral-200 transition-colors">
          Login
        </button>
        <p id="login-error" class="text-red-500 text-sm text-center hidden">Invalid password</p>
      </form>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden">
    <header class="border-b border-neutral-800 py-4 px-6">
      <div class="flex justify-between items-center max-w-6xl mx-auto">
        <h1 class="text-xl font-bold text-white">Dotty Edits Admin</h1>
        <button id="logout-btn" class="text-neutral-400 hover:text-white transition-colors">Logout</button>
      </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="border-b border-neutral-800 px-6">
      <div class="max-w-6xl mx-auto flex gap-6 overflow-x-auto">
        <button onclick="switchTab('projects')" id="tab-projects"
          class="py-4 px-2 text-sm font-medium text-neutral-400 hover:text-white transition-colors tab-active">Projects</button>
        <button onclick="switchTab('hero')" id="tab-hero"
          class="py-4 px-2 text-sm font-medium text-neutral-400 hover:text-white transition-colors">Hero</button>
        <button onclick="switchTab('about')" id="tab-about"
          class="py-4 px-2 text-sm font-medium text-neutral-400 hover:text-white transition-colors">About</button>
        <button onclick="switchTab('services')" id="tab-services"
          class="py-4 px-2 text-sm font-medium text-neutral-400 hover:text-white transition-colors">Services</button>
        <button onclick="switchTab('clients')" id="tab-clients"
          class="py-4 px-2 text-sm font-medium text-neutral-400 hover:text-white transition-colors">Clients</button>
        <button onclick="switchTab('contact')" id="tab-contact"
          class="py-4 px-2 text-sm font-medium text-neutral-400 hover:text-white transition-colors">Contact &
          Social</button>
      </div>
    </nav>

    <main class="max-w-6xl mx-auto px-6 py-8">
      <!-- Projects Tab -->
      <div id="panel-projects">
        <section class="mb-12">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-white">Long Form Projects</h2>
            <button onclick="openProjectModal('longForm')"
              class="px-4 py-2 bg-white text-black font-medium rounded-lg hover:bg-neutral-200 transition-colors">+ Add
              Project</button>
          </div>
          <div id="longForm-list" class="grid gap-4"></div>
        </section>
        <section>
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-white">Short Form Projects</h2>
            <button onclick="openProjectModal('shortForm')"
              class="px-4 py-2 bg-white text-black font-medium rounded-lg hover:bg-neutral-200 transition-colors">+ Add
              Project</button>
          </div>
          <div id="shortForm-list" class="grid gap-4"></div>
        </section>
      </div>

      <!-- Hero Tab -->
      <div id="panel-hero" class="hidden">
        <h2 class="text-2xl font-bold text-white mb-6">Hero Section</h2>
        <form id="hero-form" class="space-y-6 max-w-xl">
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Title</label>
            <input type="text" id="hero-title"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white">
          </div>
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Tagline</label>
            <input type="text" id="hero-tagline"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white">
          </div>
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Status Badge</label>
            <input type="text" id="hero-status"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white"
              placeholder="e.g., Open for Commissions">
          </div>
          <button type="submit"
            class="px-6 py-3 bg-white text-black font-bold rounded-lg hover:bg-neutral-200 transition-colors">Save
            Changes</button>
        </form>
      </div>

      <!-- About Tab -->
      <div id="panel-about" class="hidden">
        <h2 class="text-2xl font-bold text-white mb-6">About Section</h2>
        <form id="about-form" class="space-y-6 max-w-xl">
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Headline</label>
            <input type="text" id="about-headline"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white">
          </div>
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Subtitle</label>
            <input type="text" id="about-subtitle"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white">
          </div>
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Bio (paragraph 1)</label>
            <textarea id="about-bio1" rows="3"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white resize-none"></textarea>
          </div>
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Bio (paragraph 2)</label>
            <textarea id="about-bio2" rows="3"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white resize-none"></textarea>
          </div>
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Tools (comma-separated)</label>
            <input type="text" id="about-tools"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white"
              placeholder="Premiere Pro, After Effects, ...">
          </div>
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Years of Experience</label>
            <input type="number" id="about-years"
              class="w-32 px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white">
          </div>
          <button type="submit"
            class="px-6 py-3 bg-white text-black font-bold rounded-lg hover:bg-neutral-200 transition-colors">Save
            Changes</button>
        </form>
      </div>

      <!-- Services Tab -->
      <div id="panel-services" class="hidden">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-white">Services</h2>
          <button onclick="addService()"
            class="px-4 py-2 bg-white text-black font-medium rounded-lg hover:bg-neutral-200 transition-colors">+ Add
            Service</button>
        </div>
        <div id="services-list" class="grid gap-4"></div>
        <button onclick="saveServices()"
          class="mt-6 px-6 py-3 bg-white text-black font-bold rounded-lg hover:bg-neutral-200 transition-colors">Save
          All Services</button>
      </div>

      <!-- Clients Tab -->
      <div id="panel-clients" class="hidden">
        <h2 class="text-2xl font-bold text-white mb-6">Clients</h2>
        <form id="clients-form" class="space-y-6 max-w-xl">
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Client Names (comma-separated)</label>
            <textarea id="clients-list" rows="4"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white resize-none"
              placeholder="VOGUE, RED BULL, NIKE, ..."></textarea>
          </div>
          <button type="submit"
            class="px-6 py-3 bg-white text-black font-bold rounded-lg hover:bg-neutral-200 transition-colors">Save
            Changes</button>
        </form>
      </div>

      <!-- Contact & Social Tab -->
      <div id="panel-contact" class="hidden">
        <h2 class="text-2xl font-bold text-white mb-6">Contact & Social</h2>
        <form id="contact-form" class="space-y-6 max-w-xl">
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Email</label>
            <input type="email" id="contact-email"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white">
          </div>
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Availability Text</label>
            <input type="text" id="contact-availability"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white"
              placeholder="Available for freelance & collaborations">
          </div>
          <hr class="border-neutral-800 my-8">
          <h3 class="text-lg font-bold text-white">Social Links</h3>
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Instagram URL</label>
            <input type="url" id="social-instagram"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white"
              placeholder="https://instagram.com/...">
          </div>
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Twitter/X URL</label>
            <input type="url" id="social-twitter"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white"
              placeholder="https://x.com/...">
          </div>
          <div>
            <label class="block text-sm text-neutral-400 mb-2">LinkedIn URL</label>
            <input type="url" id="social-linkedin"
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white"
              placeholder="https://linkedin.com/in/...">
          </div>
          <button type="submit"
            class="px-6 py-3 bg-white text-black font-bold rounded-lg hover:bg-neutral-200 transition-colors">Save
            Changes</button>
        </form>
      </div>
    </main>
  </div>

  <!-- Project Modal -->
  <div id="project-modal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
    <div class="bg-neutral-900 border border-neutral-800 rounded-lg w-full max-w-lg p-6">
      <h3 id="project-modal-title" class="text-xl font-bold text-white mb-6">Add Project</h3>
      <form id="project-form" class="space-y-4">
        <input type="hidden" id="project-id">
        <input type="hidden" id="project-type">
        <div>
          <label class="block text-sm text-neutral-400 mb-2">Title</label>
          <input type="text" id="project-title" required
            class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white transition-colors">
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Category</label>
            <input type="text" id="project-category" required
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white transition-colors">
          </div>
          <div>
            <label class="block text-sm text-neutral-400 mb-2">Year</label>
            <input type="text" id="project-year" required
              class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white transition-colors">
          </div>
        </div>
        <div>
          <label class="block text-sm text-neutral-400 mb-2">Video Link (YouTube or Google Drive)</label>
          <input type="url" id="project-video-link" required
            class="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg text-white focus:outline-none focus:border-white transition-colors"
            placeholder="https://youtube.com/watch?v=... or https://drive.google.com/file/d/...">
          <p class="text-xs text-neutral-500 mt-1">Thumbnail extracted automatically from video.</p>
        </div>
        <div class="flex gap-3 pt-4">
          <button type="button" onclick="closeProjectModal()"
            class="flex-1 py-3 border border-neutral-700 text-neutral-300 font-medium rounded-lg hover:bg-neutral-800 transition-colors">Cancel</button>
          <button type="submit"
            class="flex-1 py-3 bg-white text-black font-bold rounded-lg hover:bg-neutral-200 transition-colors">Save</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let authToken = '';
    let projectsData = { longForm: [], shortForm: [] };
    let siteContent = {};
    let currentTab = 'projects';

    // Tab switching
    function switchTab(tab) {
      document.querySelectorAll('[id^="panel-"]').forEach(p => p.classList.add('hidden'));
      document.querySelectorAll('[id^="tab-"]').forEach(t => t.classList.remove('tab-active'));
      document.getElementById(`panel-${tab}`).classList.remove('hidden');
      document.getElementById(`tab-${tab}`).classList.add('tab-active');
      currentTab = tab;
    }

    // Login
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const password = document.getElementById('password-input').value;
      try {
        const res = await fetch('/api/admin/auth', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password })
        });
        if (res.ok) {
          authToken = password;
          sessionStorage.setItem('adminToken', password);
          showDashboard();
        } else {
          document.getElementById('login-error').classList.remove('hidden');
        }
      } catch (err) {
        console.error('Login error:', err);
      }
    });

    // Logout
    document.getElementById('logout-btn').addEventListener('click', () => {
      authToken = '';
      sessionStorage.removeItem('adminToken');
      document.getElementById('login-screen').classList.remove('hidden');
      document.getElementById('dashboard').classList.add('hidden');
    });

    // Show dashboard
    async function showDashboard() {
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
      await Promise.all([loadProjects(), loadSiteContent()]);
    }

    // Load projects
    async function loadProjects() {
      try {
        const res = await fetch('/api/projects');
        projectsData = await res.json();
        renderProjects();
      } catch (err) { console.error('Load projects error:', err); }
    }

    // Load site content
    async function loadSiteContent() {
      try {
        const res = await fetch('/api/site-content');
        siteContent = await res.json();
        populateForms();
      } catch (err) { console.error('Load content error:', err); }
    }

    // Populate forms with site content
    function populateForms() {
      // Hero
      document.getElementById('hero-title').value = siteContent.hero?.title || '';
      document.getElementById('hero-tagline').value = siteContent.hero?.tagline || '';
      document.getElementById('hero-status').value = siteContent.hero?.statusBadge || '';
      // About
      document.getElementById('about-headline').value = siteContent.about?.headline || '';
      document.getElementById('about-subtitle').value = siteContent.about?.subtitle || '';
      document.getElementById('about-bio1').value = siteContent.about?.paragraphs?.[0] || '';
      document.getElementById('about-bio2').value = siteContent.about?.paragraphs?.[1] || '';
      document.getElementById('about-tools').value = (siteContent.about?.tools || []).join(', ');
      document.getElementById('about-years').value = siteContent.about?.yearsExperience || '';

      // Services
      renderServices();
      // Clients
      document.getElementById('clients-list').value = (siteContent.clients || []).join(', ');
      // Contact & Social
      document.getElementById('contact-email').value = siteContent.contact?.email || '';
      document.getElementById('contact-availability').value = siteContent.contact?.availabilityText || '';
      document.getElementById('social-instagram').value = siteContent.social?.instagram || '';
      document.getElementById('social-twitter').value = siteContent.social?.twitter || '';
      document.getElementById('social-linkedin').value = siteContent.social?.linkedin || '';
    }

    // Render project cards
    function renderProjects() {
      ['longForm', 'shortForm'].forEach(type => {
        const container = document.getElementById(`${type}-list`);
        const projects = projectsData[type] || [];
        container.innerHTML = projects.map(p => `
          <div class="bg-neutral-900 border border-neutral-800 rounded-lg p-4 flex items-center gap-4">
            <div class="w-24 h-16 bg-neutral-800 rounded overflow-hidden flex-shrink-0">
              ${p.thumbnailUrl ? `<img src="${p.thumbnailUrl}" class="w-full h-full object-cover">` : ''}
            </div>
            <div class="flex-1 min-w-0">
              <h4 class="text-white font-medium truncate">${p.title}</h4>
              <p class="text-sm text-neutral-400">${p.category} — ${p.year}</p>
              ${p.driveVideoId ? '<span class="text-xs text-green-500">✓ Video linked</span>' : '<span class="text-xs text-neutral-500">No video</span>'}
            </div>
            <div class="flex gap-2">
              <button onclick="editProject('${type}', '${p.id}')" class="px-3 py-1 text-sm border border-neutral-700 rounded hover:bg-neutral-800 transition-colors">Edit</button>
              <button onclick="deleteProject('${type}', '${p.id}')" class="px-3 py-1 text-sm border border-red-900 text-red-400 rounded hover:bg-red-900/20 transition-colors">Delete</button>
            </div>
          </div>
        `).join('');
      });
    }

    // Render services
    function renderServices() {
      const container = document.getElementById('services-list');
      const services = siteContent.services || [];
      container.innerHTML = services.map((s, i) => `
        <div class="bg-neutral-900 border border-neutral-800 rounded-lg p-4" data-index="${i}">
          <div class="grid gap-4">
            <input type="text" value="${s.title}" placeholder="Service Title" class="svc-title w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-white text-sm">
            <textarea placeholder="Description" rows="2" class="svc-desc w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-white text-sm resize-none">${s.description}</textarea>
            <input type="text" value="${(s.tools || []).join(', ')}" placeholder="Tools (comma-separated)" class="svc-tools w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-white text-sm">
          </div>
          <button onclick="removeService(${i})" class="mt-3 text-xs text-red-400 hover:text-red-300">Remove</button>
        </div>
      `).join('');
    }

    function addService() {
      siteContent.services = siteContent.services || [];
      siteContent.services.push({ id: `svc-${Date.now()}`, title: '', description: '', tools: [] });
      renderServices();
    }

    function removeService(index) {
      siteContent.services.splice(index, 1);
      renderServices();
    }

    async function saveServices() {
      const cards = document.querySelectorAll('#services-list > div');
      siteContent.services = Array.from(cards).map((card, i) => ({
        id: siteContent.services[i]?.id || `svc-${Date.now()}-${i}`,
        title: card.querySelector('.svc-title').value,
        description: card.querySelector('.svc-desc').value,
        tools: card.querySelector('.svc-tools').value.split(',').map(t => t.trim()).filter(Boolean)
      }));
      await saveSiteContent({ services: siteContent.services });
    }

    // Save site content helper
    async function saveSiteContent(updates) {
      try {
        const res = await fetch('/api/site-content', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${authToken}` },
          body: JSON.stringify(updates)
        });
        if (res.ok) {
          const data = await res.json();
          siteContent = data.content;
          alert('Saved!');
        } else {
          alert('Failed to save');
        }
      } catch (err) { console.error('Save error:', err); alert('Save failed'); }
    }

    // Form submissions
    document.getElementById('hero-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      await saveSiteContent({
        hero: {
          title: document.getElementById('hero-title').value,
          tagline: document.getElementById('hero-tagline').value,
          statusBadge: document.getElementById('hero-status').value
        }
      });
    });

    document.getElementById('about-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      await saveSiteContent({
        about: {
          headline: document.getElementById('about-headline').value,
          subtitle: document.getElementById('about-subtitle').value,
          paragraphs: [document.getElementById('about-bio1').value, document.getElementById('about-bio2').value],
          tools: document.getElementById('about-tools').value.split(',').map(t => t.trim()).filter(Boolean),
          yearsExperience: parseInt(document.getElementById('about-years').value) || 0
        }
      });
    });

    document.getElementById('clients-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      await saveSiteContent({
        clients: document.getElementById('clients-list').value.split(',').map(c => c.trim()).filter(Boolean)
      });
    });

    document.getElementById('contact-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      await saveSiteContent({
        contact: {
          email: document.getElementById('contact-email').value,
          availabilityText: document.getElementById('contact-availability').value
        },
        social: {
          instagram: document.getElementById('social-instagram').value,
          twitter: document.getElementById('social-twitter').value,
          linkedin: document.getElementById('social-linkedin').value
        }
      });
    });

    // Project Modal
    function openProjectModal(type, project = null) {
      document.getElementById('project-modal').classList.remove('hidden');
      document.getElementById('project-modal-title').textContent = project ? 'Edit Project' : 'Add Project';
      document.getElementById('project-type').value = type;
      document.getElementById('project-id').value = project?.id || '';
      document.getElementById('project-title').value = project?.title || '';
      document.getElementById('project-category').value = project?.category || '';
      document.getElementById('project-year').value = project?.year || new Date().getFullYear();
      // Populate video link field (handle both YouTube and Drive)
      let videoLinkValue = '';
      if (project) {
        if (project.videoSource === 'youtube' && project.videoId) {
          videoLinkValue = `https://youtube.com/watch?v=${project.videoId}`;
        } else if (project.videoId || project.driveVideoId) {
          const id = project.videoId || project.driveVideoId;
          videoLinkValue = `https://drive.google.com/file/d/${id}/view`;
        }
      }
      document.getElementById('project-video-link').value = videoLinkValue;
    }

    function closeProjectModal() {
      document.getElementById('project-modal').classList.add('hidden');
      document.getElementById('project-form').reset();
    }

    function editProject(type, id) {
      const project = projectsData[type].find(p => p.id === id);
      if (project) openProjectModal(type, project);
    }

    async function deleteProject(type, id) {
      if (!confirm('Delete this project?')) return;
      try {
        const res = await fetch(`/api/admin/projects?id=${id}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${authToken}` } });
        if (res.ok) await loadProjects();
        else alert('Delete failed');
      } catch (err) { console.error(err); }
    }

    document.getElementById('project-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const type = document.getElementById('project-type').value;
      const id = document.getElementById('project-id').value;
      const payload = {
        type,
        title: document.getElementById('project-title').value,
        category: document.getElementById('project-category').value,
        year: document.getElementById('project-year').value,
        videoLink: document.getElementById('project-video-link').value
      };
      try {
        const url = id ? `/api/admin/projects?id=${id}` : '/api/admin/projects';
        const res = await fetch(url, {
          method: id ? 'PUT' : 'POST',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${authToken}` },
          body: JSON.stringify(payload)
        });
        if (res.ok) { closeProjectModal(); await loadProjects(); }
        else alert('Save failed');
      } catch (err) { console.error(err); }
    });

    // Init
    window.addEventListener('load', () => {
      const savedToken = sessionStorage.getItem('adminToken');
      if (savedToken) { authToken = savedToken; showDashboard(); }
    });
  </script>
</body>

</html>